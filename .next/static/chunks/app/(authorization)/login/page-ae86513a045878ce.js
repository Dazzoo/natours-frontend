(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{6677:function(t,e,s){"use strict";var r=s(7614);let authApi=class authApi extends r.Z{constructor(){super()}async SignUp(t,e,s,r){let a=await this.request(()=>this.http.post("/api/v1/users/signup",{name:t,email:e,password:s,passwordConfirm:r,role:"user"}),{notify_success:!0,notify_error:!0});if(String(a.status)?.startsWith("2"))return!0}async Login(t,e){let s=await this.request(()=>this.http.post("/api/v1/users/login",{email:t,password:e}),{notify_error:!0});if(s?.data.token)return s.data.token}async getMe(t){let e=await this.request(()=>this.http.get("/api/v1/users/me"));if(e?.data.data.data)return e.data.data.data}async logOut(t){let e=await this.request(()=>this.http.get("/api/v1/users/logout"));if(e?.data.status)return e.data.status}async updateUserInfo(t,e,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-info",{name:t,email:e,password:s}),{notify_success:!0,notify_error:!0});if(r?.status)return r.status}async updateUserPassword(t,e,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-password",{password:t,passwordNew:e,passwordConfirmNew:s}),{notify_success:!0,notify_error:!0});if(r?.status)return r.status}async ForgotPassword(t){let e=await this.request(()=>this.http.post("/api/v1/users/forgot-password",{email:t}),{notify_success:!1,notify_error:!1});if(e)return e}async ResetPassword(t,e,s){let r=await this.request(()=>this.http.patch(`/api/v1/users/reset-password/${t}`,{password:e,passwordConfirm:s}),{notify_success:!1,notify_error:!1});if(r)return r}async verifyEmail(t){let e=await this.request(()=>this.http.get(`/api/v1/users/verifyEmail/${t}`));if(e)return e}};e.Z=new authApi},4925:function(t,e,s){Promise.resolve().then(s.bind(s,5497))},7614:function(t,e,s){"use strict";var r=s(7415);s(4482);let a=s(5994);e.Z=class{async request(t,e){var s,a,i,n,o,u,l;try{let n=await t();return(null==e?void 0:e.notify_success)&&(null===(s=String(n.status))||void 0===s?void 0:s.startsWith("2"))&&r.toast.success("".concat((null==n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||(null==n?void 0:null===(i=n.data)||void 0===i?void 0:i.status))),n}catch(t){return(null==e?void 0:e.notify_error)&&((null==t?void 0:null===(o=t.response)||void 0===o?void 0:null===(n=o.data)||void 0===n?void 0:n.message)?r.toast.error("".concat(null==t?void 0:null===(l=t.response)||void 0===l?void 0:null===(u=l.data)||void 0===u?void 0:u.message)):t.message&&r.toast.error("".concat(t.message))),t.response}}constructor(){this.jwtHeader,this.jwtHeader=window.localStorage.getItem("jwt"),this.http=a.create({baseURL:"".concat("https://natours-back-end-f19a9ffbcdd5.herokuapp.com/"),timeout:3e4,headers:{"X-Custom-Header":"foobar",jwt:this.jwtHeader},withCredentials:!0})}}},5497:function(t,e,s){"use strict";s.r(e);var r=s(7437),a=s(2265),i=s(1865),n=s(4033),o=s(7078),u=s(6677),l=s(1167),c=s(5691);e.default=function(t){let{register:e,handleSubmit:s,formState:{errors:d},setError:p,watch:h}=(0,i.cI)(),f=(0,n.useRouter)(),{user:m,mutate:v,loggedOut:g,isLoading:w}=(0,l.Z)(),onSubmit=async t=>{let e=await u.Z.Login(t["Email address"],t.Password);e&&(localStorage.setItem("jwt",e),v(),f.push("/"),window.location.reload())};return(0,a.useEffect)(()=>{m&&f.push("/")},[m]),(0,r.jsxs)("form",{onSubmit:s(onSubmit),children:[(0,r.jsx)("div",{className:"flex flex-col mb-[2.5rem] max-md:mb-[1.4rem] relative",children:(0,r.jsx)(c.Z,{type:"text",required:!0,errors:d,register:e,pattern_value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,pattern_message:"Wrong email format",label:!0,name:"Email address"})}),(0,r.jsx)("div",{className:"flex flex-col mb-[2.5rem] relative",children:(0,r.jsx)(c.Z,{type:"password",required:!0,errors:d,register:e,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",label:!0,name:"Password"})}),(0,r.jsxs)("div",{className:"mt-[3rem] flex justify-between items-center",children:[(0,r.jsx)(o.Z,{value:"Login"}),(0,r.jsx)("a",{href:"/forgot-password",className:"text-[1.6rem] ml-[1rem] max-md:text-[1.4rem] text-grey-boulder font-semibold",children:"Forgot password ?"})]})]})}},7078:function(t,e,s){"use strict";var r=s(7437);s(2265),e.Z=function(t){let{value:e,onClick:s,className:a}=t;return(0,r.jsx)("input",{className:"py-[1.25rem] text-[1.4rem] px-[3rem] bg-green-emerald rounded-[10rem] text-white flex self-center \n  uppercase hover:translate-y-[-2px] hover-button-shadow cursor-pointer transition duration-300 ".concat(a),type:"submit",value:e,onClick:s})}},5691:function(t,e,s){"use strict";var r=s(7437),a=s(2265),i=s(3800);e.Z=function(t){var e;let{name:s,type:n,required:o,id:u,pattern_value:l,pattern_message:c,register:d,errors:p,validate:h,label:f}=t,[m,v]=(0,a.useState)(null);return(0,r.jsxs)("div",{className:"relative",children:[f?(0,r.jsx)("label",{className:" text-[1.6rem] font-bold mb-[0.75rem]",children:s}):null,(0,r.jsx)("input",{className:"bg-grey-concrete text-input-basic font-lato input-auth w-[100%] ".concat((null===(e=p[s])||void 0===e?void 0:e.type)||!l.test(m)?"input-auth-error-focus":"input-auth-valid-focus"),type:n,id:u,required:o,placeholder:s,...d("".concat(s),{pattern:{value:l,message:c},validate:h,onChange:t=>{let e=t.target.value;v(e)}})}),(0,r.jsx)("div",{className:"absolute top-[100%] text-orange-burning font-semibold text-[1.4rem]",children:(0,r.jsx)(i.B,{errors:p,name:s,render:t=>{let{message:e}=t;return(0,r.jsx)("p",{children:e})}})})]})}},1167:function(t,e,s){"use strict";s.d(e,{Z:function(){return useUser}});var r=s(2333),a=s(6677);function useUser(){let{data:t,mutate:e,isLoading:s,error:i}=(0,r.ZP)("getMe",async()=>await a.Z.getMe());return{loggedOut:!t&&!s,user:t,mutate:e,isLoading:s}}}},function(t){t.O(0,[248,918,333,971,472,744],function(){return t(t.s=4925)}),_N_E=t.O()}]);