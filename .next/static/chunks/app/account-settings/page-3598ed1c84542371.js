(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{6677:function(e,t,s){"use strict";var r=s(7614);let authApi=class authApi extends r.Z{constructor(){super()}async SignUp(e,t,s,r){let a=await this.request(()=>this.http.post("/api/v1/users/signup",{name:e,email:t,password:s,passwordConfirm:r,role:"user"}),{notify_success:!0,notify_error:!0});if(String(a.status)?.startsWith("2"))return!0}async Login(e,t){let s=await this.request(()=>this.http.post("/api/v1/users/login",{email:e,password:t}),{notify_error:!0});if(s?.data.token)return s.data.token}async getMe(e){let t=await this.request(()=>this.http.get("/api/v1/users/me"));if(t?.data.data.data)return t.data.data.data}async logOut(e){let t=await this.request(()=>this.http.get("/api/v1/users/logout"));if(t?.data.status)return t.data.status}async updateUserInfo(e,t,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-info",{name:e,email:t,password:s}),{notify_success:!0,notify_error:!0});if(r?.status)return r.status}async updateUserPassword(e,t,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-password",{password:e,passwordNew:t,passwordConfirmNew:s}),{notify_success:!0,notify_error:!0});if(r?.status)return r.status}async ForgotPassword(e){let t=await this.request(()=>this.http.post("/api/v1/users/forgot-password",{email:e}),{notify_success:!1,notify_error:!1});if(t)return t}async ResetPassword(e,t,s){let r=await this.request(()=>this.http.patch(`/api/v1/users/reset-password/${e}`,{password:t,passwordConfirm:s}),{notify_success:!1,notify_error:!1});if(r)return r}async verifyEmail(e){let t=await this.request(()=>this.http.get(`/api/v1/users/verifyEmail/${e}`));if(t)return t}};t.Z=new authApi},390:function(e,t,s){Promise.resolve().then(s.bind(s,9119))},7614:function(e,t,s){"use strict";var r=s(7415);s(4482);let a=s(5994);t.Z=class{async request(e,t){var s,a,n,i,l,o,c;try{let i=await e();return(null==t?void 0:t.notify_success)&&(null===(s=String(i.status))||void 0===s?void 0:s.startsWith("2"))&&r.toast.success("".concat((null==i?void 0:null===(a=i.data)||void 0===a?void 0:a.message)||(null==i?void 0:null===(n=i.data)||void 0===n?void 0:n.status))),i}catch(e){return(null==t?void 0:t.notify_error)&&((null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(i=l.data)||void 0===i?void 0:i.message)?r.toast.error("".concat(null==e?void 0:null===(c=e.response)||void 0===c?void 0:null===(o=c.data)||void 0===o?void 0:o.message)):e.message&&r.toast.error("".concat(e.message))),e.response}}constructor(){this.jwtHeader,this.jwtHeader=window.localStorage.getItem("jwt"),this.http=a.create({baseURL:"".concat("https://natours-back-end-f19a9ffbcdd5.herokuapp.com/"),timeout:3e4,headers:{"X-Custom-Header":"foobar",jwt:this.jwtHeader},withCredentials:!0})}}},9119:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return account_settings_page}});var r=s(7437),a=s(2265),n=s(7614);let usersApi=class usersApi extends n.Z{async updateUserImage(e){let t=await this.request(()=>this.http.post("/api/v1/users/update-photo",e,{headers:{"Content-Type":"multipart/form-data"}}),{notify_success:!0,notify_error:!0});if(null==t?void 0:t.status)return t.status}async updateUserPassword(e,t,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-password",{password:e,passwordNew:t,passwordConfirmNew:s}),{notify_success:!0,notify_error:!0});if(null==r?void 0:r.status)return r.status}constructor(){super()}};var i=new usersApi,l=s(6677),o=s(1167),c=s(4033),u=s(7078),d=s(9150),m=s(6691),p=s.n(m),h=s(5632),EditableField=function(e){let{edit:t,setEdit:s,value:n,setValue:i,onChange:l,onBlur:o}=e,c=(0,a.useRef)(null),handleInputChange=e=>{let t=e.target.value;i(t)};return(0,a.useEffect)(()=>{c.current&&t&&c.current.focus()},[c.current,t]),(0,r.jsx)("div",{children:(0,r.jsx)("input",{ref:c,onBlur:()=>{o&&o()},autofocus:!0,value:n,onChange:e=>{handleInputChange(e)},className:"".concat(t?"":"hidden"," text-right bg-transparent border-none focus:outline-none focus:ring-0 box-bordermax-w-[100%] w-[100%]"),type:"text"})})},f=s(5691),v=s(7189),x=s(1865),g=s(973),account_settings_PasswordChange=function(e){let{mutate:t}=e,[s,n]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[d,m]=(0,a.useState)(null),p=(0,c.useRouter)(),{register:h,handleSubmit:v,formState:{errors:w},watch:j}=(0,x.cI)(),handleUpdatePassword=async e=>{if(e["Current password"]&&e["New Password"]&&e["Confirm Your New Password"]){let s=await i.updateUserPassword(e["Current password"],e["New Password"],e["Confirm Your New Password"]);String(s).startsWith("2")&&(t(),p.push("/login"),window.location.reload())}};return(0,r.jsxs)("div",{className:" flex flex-col items-center p-[5rem] border-t-2 border-grey-tundora border-solid",children:[(0,r.jsx)(g.Z,{className:"mb-[2rem]",value:"Password change"}),(0,r.jsxs)("form",{onSubmit:v(handleUpdatePassword),children:[(0,r.jsx)("div",{className:"mt-[3rem] w-[30rem] ",children:(0,r.jsx)(f.Z,{id:"current-password",type:"password",errors:w,register:h,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",required:!0,name:"Current password"})}),(0,r.jsx)("div",{className:"mt-[3rem] w-[30rem] ",children:(0,r.jsx)(f.Z,{type:"password",required:!0,errors:w,register:h,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",name:"New Password"})}),(0,r.jsx)("div",{className:"mt-[3rem] w-[30rem] ",children:(0,r.jsx)(f.Z,{type:"password",required:!0,errors:w,register:h,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",validate:e=>{let t=j("New Password");return t===e||"Passwords do not match"},name:"Confirm Your New Password"})}),(0,r.jsx)("div",{className:"mt-[3rem] flex justify-center",children:(0,r.jsx)(u.Z,{value:"Update password"})})]})]})},account_settings_page=function(e){var t,s,n;let{}=e,[m,g]=(0,a.useState)(null),[w,j]=(0,a.useState)(null),[_,y]=(0,a.useState)(null),[b,N]=(0,a.useState)(null),[k,P]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),[E,Z]=(0,a.useState)(!1),[U,q]=(0,a.useState)(!1);(0,a.useRef)(null),(0,a.useRef)(null);let I=(0,c.useRouter)(),{register:O,handleSubmit:D,formState:{errors:z}}=(0,x.cI)(),{user:A,loggedOut:B,isLoading:W,mutate:R}=(0,o.Z)();(0,a.useEffect)(()=>{(null==A?void 0:A.name)&&w&&(null==A?void 0:A.name)!==w&&S(!0),(null==A?void 0:A.email)&&_&&(null==A?void 0:A.email)!==_&&S(!0)},[w,_]),(0,a.useEffect)(()=>{j(null==A?void 0:A.name),y(null==A?void 0:A.email)},[A]);let Y=(null==A?void 0:null===(t=A.photo)||void 0===t?void 0:t.path.startsWith("http"))?null==A?void 0:null===(s=A.photo)||void 0===s?void 0:s.path:(null==A?void 0:null===(n=A.photo)||void 0===n?void 0:n.path)?"".concat("https://natours-back-end-f19a9ffbcdd5.herokuapp.com/","/").concat(null==A?void 0:A.photo.path.replace(/^public\\/,"")):null,handleEditUserName=()=>{Z(e=>!e)},handleEditUserEmail=()=>{q(e=>!e)},handleUpload=async()=>{if(m){let e=new FormData;e.append("photo",m);let t=await i.updateUserImage(e);String(t).startsWith("2")&&window.location.reload()}else console.warn("No image selected")},handleSaveChanges=async e=>{if(e["Confirm Your Password"]){let t=await l.Z.updateUserInfo(w,_,e["Confirm Your Password"]);String(t).startsWith("2")&&(S(!1),window.location.reload())}else P(!0)};return((0,a.useEffect)(()=>{B&&I.push("/login")},[A,B]),W)?(0,r.jsx)("div",{className:"mt-[30vh] h-[100vh]",children:(0,r.jsx)(h.Z,{})}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"p-[5rem] flex items-center flex-col relative",children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v.Z,{className:"mb-[3.5rem]",value:"Your account settings"}),(0,r.jsx)("div",{className:"mt-[2rem] ",children:(0,r.jsx)("div",{className:"min-h-[30rem]",children:(0,r.jsx)(p(),{className:"clip-path-circle select-none drag-none w-full h-full",width:300,height:300,alt:"Profile pic",src:Y||"/img/no-user-image.jpg"})})}),(0,r.jsxs)("div",{className:"text-[1.2rem]  flex flex-col content-center items-center mt-[5rem] max-md:mt-[-2rem] ",children:[(0,r.jsx)("input",{className:" custom-file-upload text-green-emerald text-[1.6rem]  w-[14rem]",type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];g(t)}}),(0,r.jsx)("div",{className:"mt-[2rem]",children:(0,r.jsx)(u.Z,{onClick:()=>handleUpload(),value:"Update Photo"})})]}),(0,r.jsxs)("div",{className:"text-[2rem] py-[2rem] mt-[5rem] flex justify-between max-w-[35rem] w-[35rem] max-md:w-[30rem]",children:[(0,r.jsx)("div",{className:"font-medium text-black-basic select-none",children:"Name:"}),(0,r.jsxs)("div",{className:"relative w-[100%] box-border",children:[(0,r.jsx)(EditableField,{onBlur:()=>Z(!1),edit:E,setEdit:Z,value:w,setValue:j}),E?null:(0,r.jsx)("div",{className:"text-right box-border ",children:w}),(0,r.jsx)("span",{onClick:()=>{handleEditUserName()},className:"absolute left-[105%] inset-y-0 flex items-center justify-center w-min p-[1rem] cursor-pointer",children:E?(0,r.jsx)(d.bzc,{}):(0,r.jsx)(d.$iz,{})})]})]}),(0,r.jsxs)("div",{className:"text-[2rem] py-[2rem] flex justify-between max-w-[35rem] w-[35rem] max-md:w-[30rem] ",children:[(0,r.jsx)("div",{className:"font-medium text-black-basic select-none",children:"Email:"}),(0,r.jsxs)("div",{className:"relative w-[100%] box-border ",children:[(0,r.jsx)(EditableField,{onBlur:()=>q(!1),edit:U,setEdit:q,value:_,setValue:y}),U?null:(0,r.jsx)("div",{className:"text-right box-border  ",children:_}),(0,r.jsx)("span",{onClick:()=>{handleEditUserEmail()},className:"absolute left-[105%] inset-y-0 flex items-center justify-center w-min p-[1rem] cursor-pointer",children:U?(0,r.jsx)(d.bzc,{}):(0,r.jsx)(d.$iz,{})})]})]}),(0,r.jsx)("div",{className:"min-h-[5rem] my-[2rem] w-[50rem]  ",children:C?(0,r.jsx)("form",{onSubmit:D(handleSaveChanges),children:(0,r.jsxs)("div",{className:" inline-flex w-[100%] justify-between",children:[(0,r.jsx)("span",{className:"w-[30rem] ",children:(0,r.jsx)(f.Z,{setValue:N,type:"password",value:b,required:!0,register:O,errors:z,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",name:"Confirm Your Password"})}),(0,r.jsx)("span",{className:" ml-[2rem]",children:(0,r.jsx)(u.Z,{value:"Save Changes"})})]})}):null})]})}),(0,r.jsx)(account_settings_PasswordChange,{mutate:R})]})}},7078:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=function(e){let{value:t,onClick:s,className:a}=e;return(0,r.jsx)("input",{className:"py-[1.25rem] text-[1.4rem] px-[3rem] bg-green-emerald rounded-[10rem] text-white flex self-center \n  uppercase hover:translate-y-[-2px] hover-button-shadow cursor-pointer transition duration-300 ".concat(a),type:"submit",value:t,onClick:s})}},5691:function(e,t,s){"use strict";var r=s(7437),a=s(2265),n=s(3800);t.Z=function(e){var t;let{name:s,type:i,required:l,id:o,pattern_value:c,pattern_message:u,register:d,errors:m,validate:p,label:h}=e,[f,v]=(0,a.useState)(null);return(0,r.jsxs)("div",{className:"relative",children:[h?(0,r.jsx)("label",{className:" text-[1.6rem] font-bold mb-[0.75rem]",children:s}):null,(0,r.jsx)("input",{className:"bg-grey-concrete text-input-basic font-lato input-auth w-[100%] ".concat((null===(t=m[s])||void 0===t?void 0:t.type)||!c.test(f)?"input-auth-error-focus":"input-auth-valid-focus"),type:i,id:o,required:l,placeholder:s,...d("".concat(s),{pattern:{value:c,message:u},validate:p,onChange:e=>{let t=e.target.value;v(t)}})}),(0,r.jsx)("div",{className:"absolute top-[100%] text-orange-burning font-semibold text-[1.4rem]",children:(0,r.jsx)(n.B,{errors:m,name:s,render:e=>{let{message:t}=e;return(0,r.jsx)("p",{children:t})}})})]})}},5632:function(e,t,s){"use strict";var r=s(7437);s(2265),s(6691),s(6096);let BikeSVG=e=>{let{className:t}=e;return(0,r.jsx)("svg",{className:"bike ".concat(t),viewBox:"0 0 48 30",width:"48px",height:"30px",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsxs)("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",children:[(0,r.jsxs)("g",{transform:"translate(9.5,19)",children:[(0,r.jsx)("circle",{className:"bike__tire",r:"9",strokeDasharray:"56.549 56.549"}),(0,r.jsxs)("g",{className:"bike__spokes-spin",strokeDasharray:"31.416 31.416",strokeDashoffset:"-23.562",children:[(0,r.jsx)("circle",{className:"bike__spokes",r:"5"}),(0,r.jsx)("circle",{className:"bike__spokes",r:"5",transform:"rotate(180,0,0)"})]})]}),(0,r.jsx)("g",{transform:"translate(24,19)",children:(0,r.jsxs)("g",{className:"bike__pedals-spin",strokeDasharray:"25.133 25.133",strokeDashoffset:"-21.991",transform:"rotate(67.5,0,0)",children:[(0,r.jsx)("circle",{className:"bike__pedals",r:"4"}),(0,r.jsx)("circle",{className:"bike__pedals",r:"4",transform:"rotate(180,0,0)"})]})}),(0,r.jsxs)("g",{transform:"translate(38.5,19)",children:[(0,r.jsx)("circle",{className:"bike__tire",r:"9",strokeDasharray:"56.549 56.549"}),(0,r.jsxs)("g",{className:"bike__spokes-spin",strokeDasharray:"31.416 31.416",strokeDashoffset:"-23.562",children:[(0,r.jsx)("circle",{className:"bike__spokes",r:"5"}),(0,r.jsx)("circle",{className:"bike__spokes",r:"5",transform:"rotate(180,0,0)"})]})]}),(0,r.jsx)("polyline",{className:"bike__seat",points:"14 3,18 3",strokeDasharray:"5 5"}),(0,r.jsx)("polyline",{className:"bike__body",points:"16 3,24 19,9.5 19,18 8,34 7,24 19",strokeDasharray:"79 79"}),(0,r.jsx)("path",{className:"bike__handlebars",d:"m30,2h6s1,0,1,1-1,1-1,1",strokeDasharray:"10 10"}),(0,r.jsx)("polyline",{className:"bike__front",points:"32.5 2,38.5 19",strokeDasharray:"19 19"})]})})};t.Z=function(e){let{className:t}=e;return(0,r.jsx)("div",{className:"text-green-emerald ",children:(0,r.jsx)(BikeSVG,{className:t})})}},7189:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=function(e){let{value:t,className:s}=e;return(0,r.jsx)("h1",{className:"uppercase font-bold	text-[3rem] bg-green-emerald-gradient bg-clip-text text-transparent ".concat(s),children:t})}},973:function(e,t,s){"use strict";var r=s(7437);s(2265),t.Z=function(e){let{value:t,className:s}=e;return(0,r.jsx)("h2",{className:"uppercase font-bold	text-[2.25rem] bg-green-emerald-gradient bg-clip-text text-transparent ".concat(s),children:t})}},1167:function(e,t,s){"use strict";s.d(t,{Z:function(){return useUser}});var r=s(2333),a=s(6677);function useUser(){let{data:e,mutate:t,isLoading:s,error:n}=(0,r.ZP)("getMe",async()=>await a.Z.getMe());return{loggedOut:!e&&!s,user:e,mutate:t,isLoading:s}}},679:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{unstable_getImgProps:function(){return unstable_getImgProps},default:function(){return o}});let r=s(1024),a=s(7929),n=s(2637),i=s(413),l=r._(s(9950)),unstable_getImgProps=e=>{(0,n.warnOnce)("Warning: unstable_getImgProps() is experimental and may change or be removed at any time. Use at your own risk.");let{props:t}=(0,a.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}},o=i.Image},6096:function(){},6691:function(e,t,s){e.exports=s(679)},1172:function(e,t,s){"use strict";s.d(t,{w_:function(){return GenIcon}});var r=s(2265),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=r.createContext&&r.createContext(a),__assign=function(){return(__assign=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++)for(var a in t=arguments[s])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},__rest=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]]);return s};function GenIcon(e){return function(t){return r.createElement(IconBase,__assign({attr:__assign({},e.attr)},t),function Tree2Element(e){return e&&e.map(function(e,t){return r.createElement(e.tag,__assign({key:t},e.attr),Tree2Element(e.child))})}(e.child))}}function IconBase(e){var elem=function(t){var s,a=e.attr,n=e.size,i=e.title,l=__rest(e,["attr","size","title"]),o=n||t.size||"1em";return t.className&&(s=t.className),e.className&&(s=(s?s+" ":"")+e.className),r.createElement("svg",__assign({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,l,{className:s,style:__assign(__assign({color:e.color||t.color},t.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&r.createElement("title",null,i),e.children)};return void 0!==n?r.createElement(n.Consumer,null,function(e){return elem(e)}):elem(a)}}},function(e){e.O(0,[712,248,413,918,333,971,472,744],function(){return e(e.s=390)}),_N_E=e.O()}]);