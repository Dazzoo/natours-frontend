(()=>{var e={};e.id=194,e.ids=[194],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{"use strict";e.exports=require("assert")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},4234:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.ZP,__next_app__:()=>d,originalPathname:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>o});var r=s(67096),a=s(16132),n=s(38438),i=s(32564),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);s.d(t,l);let o=["",{children:["account-settings",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,97456)),"D:\\Files\\Git_repo\\natours-frontend\\app\\account-settings\\page.jsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,86786)),"D:\\Files\\Git_repo\\natours-frontend\\app\\layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,80283)),"D:\\Files\\Git_repo\\natours-frontend\\app\\error.jsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["D:\\Files\\Git_repo\\natours-frontend\\app\\account-settings\\page.jsx"],c="/account-settings/page",d={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/account-settings/page",pathname:"/account-settings",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},38674:(e,t,s)=>{Promise.resolve().then(s.bind(s,35820))},35820:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>account_settings_page});var r=s(30784),a=s(9885),n=s(58801);let usersApi=class usersApi extends n.Z{constructor(){super()}async updateUserImage(e){let t=await this.request(()=>this.http.post("/api/v1/users/update-photo",e,{headers:{"Content-Type":"multipart/form-data"}}),{notify_success:!0,notify_error:!0});if(t?.status)return t.status}async updateUserPassword(e,t,s){let r=await this.request(()=>this.http.patch("/api/v1/users/update-password",{password:e,passwordNew:t,passwordConfirmNew:s}),{notify_success:!0,notify_error:!0});if(r?.status)return r.status}};let i=new usersApi;var l=s(15113),o=s(50951),u=s(57114),c=s(75605),d=s(15816),m=s(52451),p=s.n(m),x=s(36661);let EditableField=function({edit:e,setEdit:t,value:s,setValue:n,onChange:i,onBlur:l}){let o=(0,a.useRef)(null),handleInputChange=e=>{let t=e.target.value;n(t)};return(0,a.useEffect)(()=>{o.current&&e&&o.current.focus()},[o.current,e]),r.jsx("div",{children:r.jsx("input",{ref:o,onBlur:()=>{l&&l()},autofocus:!0,value:s,onChange:e=>{handleInputChange(e)},className:`${e?"":"hidden"} text-right bg-transparent border-none focus:outline-none focus:ring-0 box-bordermax-w-[100%] w-[100%]`,type:"text"})})};var h=s(63024),f=s(73611),g=s(66558),w=s(41259);let account_settings_PasswordChange=function({mutate:e}){let[t,s]=(0,a.useState)(null),[n,l]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),m=(0,u.useRouter)(),{register:p,handleSubmit:x,formState:{errors:f},watch:_}=(0,g.cI)(),handleUpdatePassword=async t=>{if(t["Current password"]&&t["New Password"]&&t["Confirm Your New Password"]){let s=await i.updateUserPassword(t["Current password"],t["New Password"],t["Confirm Your New Password"]);String(s).startsWith("2")&&(e(),m.push("/login"),window.location.reload())}};return(0,r.jsxs)("div",{className:" flex flex-col items-center p-[5rem] border-t-2 border-grey-tundora border-solid",children:[r.jsx(w.Z,{className:"mb-[2rem]",value:"Password change"}),(0,r.jsxs)("form",{onSubmit:x(handleUpdatePassword),children:[r.jsx("div",{className:"mt-[3rem] w-[30rem] ",children:r.jsx(h.Z,{id:"current-password",type:"password",errors:f,register:p,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",required:!0,name:"Current password"})}),r.jsx("div",{className:"mt-[3rem] w-[30rem] ",children:r.jsx(h.Z,{type:"password",required:!0,errors:f,register:p,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",name:"New Password"})}),r.jsx("div",{className:"mt-[3rem] w-[30rem] ",children:r.jsx(h.Z,{type:"password",required:!0,errors:f,register:p,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",validate:e=>{let t=_("New Password");return t===e||"Passwords do not match"},name:"Confirm Your New Password"})}),r.jsx("div",{className:"mt-[3rem] flex justify-center",children:r.jsx(c.Z,{value:"Update password"})})]})]})},account_settings_page=function({}){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(null),[m,w]=(0,a.useState)(null),[_,v]=(0,a.useState)(null),[j,b]=(0,a.useState)(!1),[P,N]=(0,a.useState)(!1),[y,E]=(0,a.useState)(!1),[q,C]=(0,a.useState)(!1);(0,a.useRef)(null),(0,a.useRef)(null);let S=(0,u.useRouter)(),{register:U,handleSubmit:A,formState:{errors:Z}}=(0,g.cI)(),{user:F,loggedOut:k,isLoading:G,mutate:D}=(0,o.Z)();(0,a.useEffect)(()=>{F?.name&&s&&F?.name!==s&&N(!0),F?.email&&m&&F?.email!==m&&N(!0)},[s,m]),(0,a.useEffect)(()=>{n(F?.name),w(F?.email)},[F]);let R=F?.photo?.path.startsWith("http")?F?.photo?.path:F?.photo?.path?`https://natours-back-end-f19a9ffbcdd5.herokuapp.com//${F?.photo.path.replace(/^public\\/,"")}`:null,handleEditUserName=()=>{E(e=>!e)},handleEditUserEmail=()=>{C(e=>!e)},handleUpload=async()=>{if(e){let t=new FormData;t.append("photo",e);let s=await i.updateUserImage(t);String(s).startsWith("2")&&window.location.reload()}else console.warn("No image selected")},handleSaveChanges=async e=>{if(e["Confirm Your Password"]){let t=await l.Z.updateUserInfo(s,m,e["Confirm Your Password"]);String(t).startsWith("2")&&(N(!1),window.location.reload())}else b(!0)};return((0,a.useEffect)(()=>{k&&S.push("/login")},[F,k]),G)?r.jsx("div",{className:"mt-[30vh] h-[100vh]",children:r.jsx(x.Z,{})}):(0,r.jsxs)("div",{children:[r.jsx("div",{className:"p-[5rem] flex items-center flex-col relative",children:(0,r.jsxs)(r.Fragment,{children:[r.jsx(f.Z,{className:"mb-[3.5rem]",value:"Your account settings"}),r.jsx("div",{className:"mt-[2rem] ",children:r.jsx("div",{className:"min-h-[30rem]",children:r.jsx(p(),{className:"clip-path-circle select-none drag-none w-full h-full",width:300,height:300,alt:"Profile pic",src:R||"/img/no-user-image.jpg"})})}),(0,r.jsxs)("div",{className:"text-[1.2rem]  flex flex-col content-center items-center mt-[5rem] max-md:mt-[-2rem] ",children:[r.jsx("input",{className:" custom-file-upload text-green-emerald text-[1.6rem]  w-[14rem]",type:"file",accept:"image/*",onChange:e=>{let s=e.target.files[0];t(s)}}),r.jsx("div",{className:"mt-[2rem]",children:r.jsx(c.Z,{onClick:()=>handleUpload(),value:"Update Photo"})})]}),(0,r.jsxs)("div",{className:"text-[2rem] py-[2rem] mt-[5rem] flex justify-between max-w-[35rem] w-[35rem] max-md:w-[30rem]",children:[r.jsx("div",{className:"font-medium text-black-basic select-none",children:"Name:"}),(0,r.jsxs)("div",{className:"relative w-[100%] box-border",children:[r.jsx(EditableField,{onBlur:()=>E(!1),edit:y,setEdit:E,value:s,setValue:n}),y?null:r.jsx("div",{className:"text-right box-border ",children:s}),r.jsx("span",{onClick:()=>{handleEditUserName()},className:"absolute left-[105%] inset-y-0 flex items-center justify-center w-min p-[1rem] cursor-pointer",children:y?r.jsx(d.bzc,{}):r.jsx(d.$iz,{})})]})]}),(0,r.jsxs)("div",{className:"text-[2rem] py-[2rem] flex justify-between max-w-[35rem] w-[35rem] max-md:w-[30rem] ",children:[r.jsx("div",{className:"font-medium text-black-basic select-none",children:"Email:"}),(0,r.jsxs)("div",{className:"relative w-[100%] box-border ",children:[r.jsx(EditableField,{onBlur:()=>C(!1),edit:q,setEdit:C,value:m,setValue:w}),q?null:r.jsx("div",{className:"text-right box-border  ",children:m}),r.jsx("span",{onClick:()=>{handleEditUserEmail()},className:"absolute left-[105%] inset-y-0 flex items-center justify-center w-min p-[1rem] cursor-pointer",children:q?r.jsx(d.bzc,{}):r.jsx(d.$iz,{})})]})]}),r.jsx("div",{className:"min-h-[5rem] my-[2rem] w-[50rem]  ",children:P?r.jsx("form",{onSubmit:A(handleSaveChanges),children:(0,r.jsxs)("div",{className:" inline-flex w-[100%] justify-between",children:[r.jsx("span",{className:"w-[30rem] ",children:r.jsx(h.Z,{setValue:v,type:"password",value:_,required:!0,register:U,errors:Z,pattern_value:/.{8,}/,pattern_message:"At least 8 characters is required",name:"Confirm Your Password"})}),r.jsx("span",{className:" ml-[2rem]",children:r.jsx(c.Z,{value:"Save Changes"})})]})}):null})]})}),r.jsx(account_settings_PasswordChange,{mutate:D})]})}},73611:(e,t,s)=>{"use strict";s.d(t,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=s(30784);s(9885);let __WEBPACK_DEFAULT_EXPORT__=function({value:e,className:t}){return r.jsx("h1",{className:`uppercase font-bold	text-[3rem] bg-green-emerald-gradient bg-clip-text text-transparent ${t}`,children:e})}},41259:(e,t,s)=>{"use strict";s.d(t,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=s(30784);s(9885);let __WEBPACK_DEFAULT_EXPORT__=function({value:e,className:t}){return r.jsx("h2",{className:`uppercase font-bold	text-[2.25rem] bg-green-emerald-gradient bg-clip-text text-transparent ${t}`,children:e})}},97456:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var r=s(95153);let a=(0,r.createProxy)(String.raw`D:\Files\Git_repo\natours-frontend\app\account-settings\page.jsx`),{__esModule:n,$$typeof:i}=a,l=a.default,o=l}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[993,323,878,816,166,157],()=>__webpack_exec__(4234));module.exports=s})();